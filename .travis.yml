language: generic

jobs:
  include:
    - stage: build docker image
      script:
        - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
        - docker-compose build
        - docker images
        - docker-compose push videar-test
    - stage: test
      script:
        - docker-compose run --rm videar-test

after_success:
  - docker images
  - docker-compose push

# safelist
branches:
  only:
  - master

# no need to pollute inboxes
notifications:
  email: false