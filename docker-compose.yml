version: '2'

services:
  videar:
    image: mkaichen/videar:latest
    build: 
      context: .
      dockerfile: dockerbuilds/Dockerfile-main
    volumes:
      - /usr/src/videar
    environment:
      - DB_HOST=central_mongodb
      - PORT=80
    ports:
      - "80:80"
    depends_on: 
      - central_mongodb

  videar-test:
    image: mkaichen/videar-test:latest
    build: 
      context: .
      dockerfile: dockerbuilds/Dockerfile-maintest
    volumes:
      - /usr/src/videar
    environment:
      - DB_HOST=central_mongodb
      - SPEECH_HOST=speech2text
    depends_on:
      - central_mongodb

  speech2text:
    image: mkaichen/rocnnet-s2t:latest
    build: 
      context: .
      dockerfile: dockerbuilds/Dockerfile-s2t
    volumes:
      - /usr/src/s2t

  central_mongodb:
    image: mongo:latest
    ports:
      - "27017:27017"
    volumes: 
      - /data/db
    restart: always
