version: '2'

services:
  videar-test:
    image: mkaichen/videar:latest
    environment:
      - DB_HOST=central_mongodb
      - CACHE_HOST=central_redis
      - SPEECH_HOST=speech2text
      - NODE_ENV=test
    command: [ "npm", "test" ]
    depends_on: 
      - central_mongodb
      - central_redis
      - uni_audio

  # # placeholder for s2t
  # speech2text:
  #   image: mkaichen/rocnnet-s2t:latest
  #   build: _services/s2t
  #   environment:
  #     - DB_HOST=central_mongodb
  #   volumes:
  #     - /usr/src/s2t

  # obtain audio from multiple 3rd party sources
  uni_audio:
    image: mkaichen/uni_audio:latest
    environment:
      - DB_HOST=central_mongodb
      - AUDIOSEARCH_APP_ID=$AUDIOSEARCH_APP_ID
      - AUDIOSEARCH_SECRET=$AUDIOSEARCH_SECRET
    ports:
      - "3124:3124"
    depends_on: 
      - central_mongodb

  # mongo
  central_mongodb:
    image: mongo:latest
    ports:
      - "27017:27017" 
    restart: always

  # redis
  central_redis:
    image: redis:latest
    ports:
      - "6379:6379"
    restart: always
